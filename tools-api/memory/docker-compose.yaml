services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    environment:
      - QDRANT_LOG_LEVEL=DEBUG
      - VECTOR_DIM=768
    ports:
      - "5100:5100" # UI
      - "6333:6333" # HTTP API
    volumes:
      - C:/docker-data/qdrant/storage:/qdrant/storage
    restart: unless-stopped
    networks:
      - webtools_network

  memory:
    build:
      context: ..
      dockerfile: memory/Dockerfile
    container_name: memory
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - INDEX_NAME=user_memory_collection
      - EMBEDDING_PROVIDER=sentence_transformers
      - SUMMARY_MODEL=sshleifer/distilbart-cnn-12-6
      - SUMMARY_DEVICE=cpu
    ports:
      - "8000:8000"
    depends_on:
      - qdrant
    restart: unless-stopped
    networks:
      - webtools_network

  # ---------------------------------------------------------
  # Pragmatics service (tiny FastAPI)
  # ---------------------------------------------------------
  # Pragmatics service is now composed from the top-level docker/docker-compose.yaml

networks:
  webtools_network:
    external: true
